<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Zen Dragon Trainer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- האפליקציה נטענת מ-game.js -->
  <div id="app"></div>

  <!-- 📖 Instructions Modal -->
  <div id="instructionsModal" class="modal hidden">
    <div class="modal-box">
      <div class="modal-head">
        <button id="closeInstructions" class="btn">✖</button>
        <button id="langToggle" class="btn">עברית</button>
      </div>
      <div id="instructionsContent" class="modal-body"></div>
    </div>
  </div>

  <!-- 🎯 Targets (Goals) Modal -->
  <div id="targetsModal" class="modal hidden">
    <div class="modal-box" style="max-width:560px">
      <div class="modal-head">
        <h3 style="margin:0">🎯 Set Goals</h3>
        <button id="tgClose" class="btn">✖</button>
      </div>
      <div class="modal-body">
        <div class="targets-grid">
          <label>Accuracy ≥ <input id="tgAcc" type="number" min="50" max="100" step="1"> %</label>
          <label>Avg. time ≤ <input id="tgAvg" type="number" min="300" max="5000" step="10"> ms</label>
          <label>Mistakes ≤ <input id="tgMist" type="number" min="0" max="20" step="1"></label>
        </div>
        <div class="targets-actions">
          <button id="tgReset" class="btn">Reset Defaults</button>
          <button id="tgSave" class="btn">Save</button>
        </div>
        <div class="targets-hint">
          These goals drive unlocks (based on the average of your last 3 battles per difficulty).
        </div>
      </div>
    </div>
  </div>

  <script>
  /* ===== Instructions content (HE/EN) ===== */
  const INS_HE = `
  <div dir="rtl" style="text-align:right">
  <h2>הוראות שימוש</h2>

  <h3>מה המטרה?</h3>
  אימון ממוקד לפיתוח מהירות, דיוק וביטחון בחישוב בראש: לוח כפל, חזקות, שורשים ושברים.
  המשחק מאתר את החולשות שלך בזמן אמת ודוחף אותך להשתפר בצורה חכמה והדרגתית.

  <h3>מצבי משחק</h3>
  <b>⚔️ מצב קרב (Combat)</b><br>
  תרגול משולב מכל הנושאים, לפי רמת קושי. לאחר כל קרב תופיע טבלת הישגים, ניתוח ביצועים, והמלצה מדויקת מה לחזק.
  <br><br>
  <b>📚 מצב תרגול (Practice)</b><br>
  בחירה של נושא אחד והעמקה בו. טעויות נשמרות ומופיעות מחדש באימון ייעודי לנטרול חולשות לאורך זמן.

  <h3>איך מתחילים?</h3>
  בוחרים רמה → Start Battle. הזמן מתחיל להימדד רק מהרגע שלוחצים על Start.

  <h3>איך עונים?</h3>
  מקשי 1–4 או לחיצה על האפשרות במסך. תשובה נכונה תנגן צליל קצר.

  <h3>קריטריונים לעליית רמה</h3>
  (ממוצע של 3 הקרבות האחרונים באותה רמה) — לפי היעדים שבחרת במסך “Goals”.

  <h3>ה־HUD</h3>
  מציג ממוצעים משלושת הקרבות האחרונים + Weak Topics.

  <h3>איך מזוהות חולשות?</h3>
  <b>⏱ איטיות:</b> >50% איטי מהממוצע (עם באפר לשורשים/שברים).<br>
  <b>✖ שגיאות:</b> ≥40% טעויות בנושא.

  <h3>תיקון טעויות</h3>
  טעות נמחקת אחרי 2 הצלחות בשני Review שונים עם סשנים רגילים ביניהם.

  <h3>טיפ</h3>
  לא נתקעים — זורמים. המערכת תחזיר אותך למה שצריך.
  </div>
  `;
  const INS_EN = `
  <h2>Instructions</h2>
  <h3>Purpose</h3>
  Boost mental calculation speed, accuracy, and confidence — multiplication, powers, roots, and fractions.
  <h3>Game Modes</h3>
  <b>⚔️ Combat</b> mixed by difficulty; report & recommendations after each battle.
  <br><br><b>📚 Practice</b> focus one topic; mistakes resurface in structured reviews.
  <h3>Unlocks</h3>
  Based on your custom goals (average of the last 3 battles per difficulty).
  <h3>Answering</h3>
  Keys 1–4 or click. Chime on correct.
  <h3>Mistake Bank</h3>
  Erase after 2 correct answers across 2 separate reviews with normal sessions in between.
  `;

  /* Modal logic */
  let INS_LANG = 'en';
  const insModal = document.getElementById('instructionsModal');
  const insContent = document.getElementById('instructionsContent');
  const insLangBtn = document.getElementById('langToggle');

  function renderInstructions(){
    if (INS_LANG==='en'){ insContent.innerHTML = INS_EN; insLangBtn.textContent='עברית'; insContent.removeAttribute('dir'); insContent.style.textAlign='start'; }
    else { insContent.innerHTML = INS_HE; insLangBtn.textContent='English'; insContent.setAttribute('dir','rtl'); insContent.style.textAlign='right'; }
  }
  document.getElementById('closeInstructions').onclick = () => insModal.classList.add('hidden');
  document.getElementById('langToggle').onclick = () => { INS_LANG = (INS_LANG==='en')?'he':'en'; renderInstructions(); };
  window.__openInstructions = () => { insModal.classList.remove('hidden'); renderInstructions(); };

  /* ===== Goals modal wiring (used by game.js) ===== */
  const tgModal = document.getElementById('targetsModal');
  const tgAcc   = document.getElementById('tgAcc');
  const tgAvg   = document.getElementById('tgAvg');
  const tgMist  = document.getElementById('tgMist');

  window.__openTargets = (targets) => {
    tgAcc.value  = targets.acc;
    tgAvg.value  = targets.avgMs;
    tgMist.value = targets.mist;
    tgModal.classList.remove('hidden');
  };
  window.__closeTargets = () => tgModal.classList.add('hidden');
  window.__readTargets = () => ({
    acc:  Math.max(50, Math.min(100, parseInt(tgAcc.value||95))),
    avgMs:Math.max(300, Math.min(5000, parseInt(tgAvg.value||1500))),
    mist: Math.max(0,  Math.min(20,  parseInt(tgMist.value||3)))
  });

  document.getElementById('tgClose').onclick = () => window.__closeTargets();
  document.getElementById('tgSave').onclick  = () => { window.__saveTargetsFromModal && window.__saveTargetsFromModal(); };
  document.getElementById('tgReset').onclick = () => { tgAcc.value=95; tgAvg.value=1500; tgMist.value=3; };
  </script>

  <script src="game.js"></script>
</body>
</html>








